<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ORANGE-BLUE-GPS</title>
    <link rel="stylesheet" href="index.css" />


    <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script
            src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
    </script>
</head>


<body>
<div id = "root" class="full">


    <div id="top" class="dark heavy" >

        <div id="center" class="flex">ORANGE-BLUE GPS </div>

    </div>

    <div id="main" class="light">

        <div id="position">
            Position: <span id="lat">....</span>, <span id="lon">....</span>
        </div>
        <div id="map"></div>

    </div>

    <div id="bottom" class="dark">
        project by ....
    </div>

</div>

<script>
    const GPS_URL = "https://organgeblue2gps.mo681wei.workers.dev/";

    // 1️⃣ Karte IMMER initialisieren
    const map = L.map("map").setView([0, 0], 2);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap"
    }).addTo(map);

    let marker = null;

    // 2️⃣ GPS optional nachladen
    async function loadGps() {
        try {
            const res = await fetch(GPS_URL);
            if (!res.ok) throw new Error("GPS offline");

            const pos = await res.json();
            if (!pos) return;

            document.getElementById("lat").innerText = pos.latitude;
            document.getElementById("lon").innerText = pos.longitude;

            if (!marker) {
                marker = L.marker([pos.latitude, pos.longitude]).addTo(map);
                map.setView([pos.latitude, pos.longitude], 13);
            } else {
                marker.setLatLng([pos.latitude, pos.longitude]);
            }
        } catch (e) {
            console.warn("GPS nicht erreichbar");
        }
    }

    loadGps();
    setInterval(loadGps, 10000);
</script>






</body>
</html>