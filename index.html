<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ORANGE-BLUE-GPS</title>
    <link rel="stylesheet" href="index.css" />
</head>


<body>
<div id = "root" class="full">


    <div id="top" class="dark heavy" >

        <div id="center" class="flex">ORANGE-BLUE GPS </div>

    </div>

    <div id="main" class="light">

        <div id="position">
            Position: <span id="lat">....</span>, <span id="lon">....</span>
        </div>
        <div id="map"></div>

    </div>

    <div id="bottom" class="dark">
        project by Moritz  für tobias beck
    </div>

</div>





<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const gpsUrl = "http://<server-ip>:3000/gps"; // Docker oder Worker URL

    // Leaflet Karte initialisieren
    const map = L.map('map').setView([0, 0], 2); // Start bei 0,0
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap'
    }).addTo(map);

    let marker = null;

    // Funktion: GPS-Daten abrufen und Karte aktualisieren
    async function updatePosition() {
        try {
            const res = await fetch(gpsUrl);
            const pos = await res.json();
            if(!pos) return;

            // Textfelder aktualisieren
            document.getElementById("lat").innerText = pos.latitude;
            document.getElementById("lon").innerText = pos.longitude;

            // Marker setzen oder verschieben
            if(marker){
                marker.setLatLng([pos.latitude, pos.longitude]);
            } else {
                marker = L.marker([pos.latitude, pos.longitude]).addTo(map)
                    .bindPopup(`Device: ${pos.device}<br>Altitude: ${pos.altitude_m ?? '-'} m`)
                    .openPopup();
            }

            // Karte zentrieren
            map.setView([pos.latitude, pos.longitude], 13);

        } catch(err){
            console.error("Fehler beim Laden der GPS-Daten:", err);
        }
    }

    // Initial laden
    updatePosition();

    // Auto-Refresh alle 10 Sekunden
    setInterval(updatePosition, 10000);
</script>

</body>
</html>