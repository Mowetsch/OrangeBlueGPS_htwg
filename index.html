<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ORANGE-BLUE-GPS</title>
    <link rel="stylesheet" href="index.css" />


    <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script
            src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
    </script>
</head>


<body>
<div id = "root" class="full">


    <div id="top" class="dark heavy" >

        <div id="center" class="flex">ORANGE-BLUE GPS </div>

    </div>

    <div id="main" class="light">

        <div id="position">
            Position: <span id="lat">....</span>, <span id="lon">....</span>
        </div>
        <div id="map"></div>

    </div>

    <div id="bottom" class="dark">
        Projekt von Moritz Weis, Samuel Ebinger | Betreut durch Prof. Dr. Boris Böck
    </div>

</div>

<script>
    const gps_url = "https://organgeblue2gps.mo681wei.workers.dev/";
    const map = L.map("map").setView([0, 0], 2);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap"
    }).addTo(map);

    let marker = null;

    async function loadGps() {
        try {
            const res = await fetch(gps_url);
            if (!res.ok) throw new Error("No Data");

            const pos = await res.json();
            if (!pos || !pos.latitude || !pos.longitude) return;

            document.getElementById("lat").innerText = pos.latitude.toFixed(5);
            document.getElementById("lon").innerText = pos.longitude.toFixed(5);

            if (!marker) {
                marker = L.marker([pos.latitude, pos.longitude]).addTo(map);
                map.setView([pos.latitude, pos.longitude], 12);
            } else {
                marker.setLatLng([pos.latitude, pos.longitude]);
            }
        } catch (e) {
            console.warn("Keine verbindung zu JS", e);
        }
    }


    loadGps();
    setInterval(loadGps, 7000);
</script>





</body>
</html>